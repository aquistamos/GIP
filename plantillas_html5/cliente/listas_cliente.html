{% extends "cliente/base_cliente.html" %}
{% load staticfiles %}

{% block imports %}
<link rel="stylesheet" href="{% static "gip_html5/css/form.css" %}" >
<script src="{% static "gip_html5/js/modal.js" %}" ></script>
<!-- http://code.google.com/p/jquery-inline-editor/ -->
<script src="{% static "gip_html5/js/jquery.inplacerowedit.js" %}" ></script>
{% endblock %}

{% block body %}
{% endblock %}

{% block purejavascript %}

dirty = 0;
function addHidden(theForm, key, value) {
    // Create a hidden input element, and append it to the form:
    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = key;'name-as-seen-at-the-server';
    input.value = value;
    theForm.appendChild(input);
}

function submitform()
{
  if (dirty == 0){
    myform = document.forms["form"];
    // add your favorite JS validators here
    //TODO: check for duplicated names for instance or only white spaces
    addHidden(myform,'lista_to_add', document.getElementById('nueva_lista').value)
    myform.submit();
  }
  else
  {
    alert('Parece que has olvidado guardar los cambios en las listas');
  }
  
}

function delform(id)
{
  alert('we are '+id);
  if (dirty == 0){
    myform = document.forms["form_del"];
    addHidden(myform,'lista_to_del', id)
    myform.submit();
  }
  else
  {
    alert('Parece que has olvidado guardar los cambios en las listas');
  }
}


function show(id){
//learn js... 
current_status = document.getElementById('lista_'+id).style.display;

{% for lista, elementos in full_listas.iteritems %}
document.getElementById('lista_{{ lista.id }}').style.display='none';
{% endfor %}

  if (current_status == 'none')
  {
    document.getElementById('lista_'+id).style.display='';
  }else
  {
    document.getElementById('lista_'+id).style.display='none';
  }
}

{% endblock %}


{% block filtercategory %}

{% endblock %}
{% block content %}
<section class="content gallery pad1"><div class="ic">Add something smart here</div>
  <div class="container">
    <!-- Collection of lists -->
    <div class="row">
    {% for lista, elementos in full_listas.iteritems %}
      <a href="#" class="btn" onclick="show({{ lista.id }});"> {{ lista.nombre }}</a>
    {% endfor %}
    </div>
    <!-- END Colection of lists -->
</section>

    <!-- Add a list -->
<div class="form_block">
  <div class="container">
    <div class="row">
        <form id="form" action="http://localhost:8080/cliente/listas/add/{{ current_user.id }}" method="post">
        <div class="response-error-message"></div>
        <label class="lista">
        <input type="text" name="lista" id="nueva_lista" placeholder="Crear lista:" value="" data-constraints="@Required @JustLetters" />
        <span class="empty-message">*Debes añadir un nombre.</span>
        <span class="error-message">*No es un nombre valido.</span>
        </label>
        <a href="/cliente/listas/" onclick="javascript: submitform()"  class="btn" style="float:left; margin-top: 0px; padding:5px 34px 20px;">Añadir</a>
        </div>
        {% csrf_token %}

        </form>
    </div>
  </div>
</div>
    <!-- END Add a list -->
    <!-- Hidden lists -->
<section class="content"><div class="ic">Add something smart here</div>
  <div class="container">
    <div class="row">
        <div class="blog">
        <form id="form_del" action="http://localhost:8080/cliente/listas/del/{{ current_user.id }}" method="post">
	        {% csrf_token %}
        </form>

          {% for lista, elementos in full_listas.iteritems %}
          <div id="lista_{{ lista.id }}" style="display:none">
          <table><tr><td>{{ lista.nombre }}<td><a href="#" onclick="javascript: delform('{{ lista.id }}')" style="font-size:8" class="fa fa-trash-o"></td></tr></table>
          <br>
          <!-- TODO: rovide nice center and style for numbers and so on-->
            <table id="table_lista_{{ lista.id }}">
              <thead>
                <tr>
                  <th>elemento</th>
                  <th>nombre </th>
                  <th>Cantidad</th>
                  <th>Precio</th>
                </tr>
              </thead>
            
              <tbody>
             {% for i in elementos %}
                <tr>
                  <td>
                  <!-- {{ i.id }}--> {{ i.nombre }}
                  </td>
                  <td>{{ i.producto.nombre }}</td>
                  <td><a href="#" id="elem_{{lista.id}}_{{ i.id }}" data-type="text" data-pk="1" data-url="/post">{{ i.cantidad }}<td>
                  <td>{{ i.producto.precio }}</td>
                </tr>
            
             {% endfor %}
              </tbody>
            </table>
          </div>
          {% endfor %}
      </div>
    </div>
  </div>
    <!-- END Hidden lists -->
</section>



{% endblock %}

