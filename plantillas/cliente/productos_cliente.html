{% extends "cliente/base_cliente.html" %}
{% load staticfiles %}
{% block body %}
  <body onload="fill_search_params()" style="height: 100%">
{% endblock %}



{% block filtercategory %}
<script>
function update_categoria(cat_id)
{
  current_ul = document.getElementById('categoria_menu')
  current_cat = document.getElementById(cat_id)
  document.getElementById('categoria').innerHTML = current_cat.innerHTML
  // TODO: get sub categoria list using an ajax tool :/
  // must send the quer
}
function update_subcategoria(sub_cat_id)
{
  current_sub_ul = document.getElementById('subcategoria_menu')
  current_sub_cat = document.getElementById(sub_cat_id)
  document.getElementById('subcategoria').innerHTML = current_cat.innerHTML

}

function remove_categoria(){
  current_ul = document.getElementById('categoria').innerHTML='Elige una Categoria'
}

function remove_sub_categoria(){
  current_ul = document.getElementById('subcategoria').innerHTML='Elige una Sub Categoria'
}

function addHidden(theForm, key, value) {
    // Create a hidden input element, and append it to the form:
    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = key;'name-as-seen-at-the-server';
    input.value = value;
    theForm.appendChild(input);
}

//Javascript to collect info from form id = search_form
function submitform()
{
  dirty = 0;
  myform = document.forms["search_form"];
  myform.page = '{{ product_list.number }}';
  cat = document.getElementById('categoria').textContent
  //really hand made :( TODO: use jquery and handle the string from menus too, so they will always fit. Get the originals from jinja templates
  if (cat.indexOf("Elige una Categoria") < 0 )
  {
    addHidden(myform,'categoria', document.getElementById('categoria').textContent)
    dirty = 1;
  }


  if (document.getElementById('subcategoria'))
  {
    subcat = document.getElementById('subcategoria').textContent
    if (subcat.indexOf("Elige una Sub Categoria") < 0 )
    {
      addHidden(myform,'subcategoria', document.getElementById('subcategoria').textContent)
      dirty = 1;
    }
  }

  if (document.getElementById('search').value != "")
  {
    if (document.getElementById('search').value.length < 3)
    {
      alert('Por favor, introduce al menos 3 caracteres')
      return;
    }
    addHidden(myform,'search', document.getElementById('search').value)

    dirty = 1;
  }
  if (dirty == 0 )
  {
    alert('Por favor, introduce algun filtro');
    return;
  }
  myform.submit();
  
}

function fill_search_params()
{ 
      {% for campo, valor in search_parameters.iteritems %}
        document.getElementById('{{ campo }}').innerHTML = '{{ valor }}';
        {% if campo == 'search'%}

	  document.getElementById('default_value').innerHTML=""
          document.getElementById('{{ campo }}').value = '{{ valor }}';


        {% endif %}
      {% endfor %}
}

</script>
          <button class="mdl-button mdl-js-button mdl-js-ripple-effect" id="categoria">
             Elige una Categoria <!-- va a faltar un JS inteligente que actualice esto -->
          </button>
          <ul class="mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right" for="categoria" id="categoria_menu">
{% for categoria in categorias_list %}
            <li class="mdl-menu__item" onclick="update_categoria('cat_{{ categoria.id }}')" id="cat_{{ categoria.id }}">{{ categoria.nombre }} </li>
{% endfor %}
             <li class="mdl-menu__item" onclick="remove_categoria()" id="None">Eliminar Filtro</li>
          </ul>
{% if sub_categorias_list %}
          <button class="mdl-button mdl-js-button mdl-js-ripple-effect" id="subcategoria">
             Elige una SubCategoria
          </button>
  {% for subcategoria in sub_categorias_list %}
              <li class="mdl-menu__item" onclick="update_sub_categoria('sub_cat_{{ categoria.id }}')" id="sub_cat_{{ categoria.id }}">{{ categoria.nombre }} </li>
  {% endfor %}
              <li class="mdl-menu__item" onclick="remove_sub_categoria()" id="None">Eliminar Filtro</li>

{% endif %}
          <ul class="mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right" for="subcategoria">
            <!-- Elementos del menu de la derecha -->
            <li class="mdl-menu__item">Cat1</li>
            <li class="mdl-menu__item">Cat2</li>
            <li class="mdl-menu__item">Cat3</li>
          </ul>

          <div class="mdl-layout-spacer"></div>
<div class="mdl-textfield mdl-js-textfield mdl-textfield">
<!--   <label class="mdl-button mdl-js-button mdl-button--icon" for="search"> -->
<!--    <i class="material-icons">search</i>  -->
<!--   </label>  -->
  <div class="mdl-textfield">
    <input class="mdl-textfield__input" type="text" id="search" />
    <label class="mdl-textfield__label" for="search" id="default_value">Busqueda de Producto</label>
  </div>
</div>

<div class="mdl-layout-spacer"></div>

<div class="mdl-textfield mdl-js-textfield mdl-textfield">
  <div class="mdl-textfield">
    <input class="mdl-textfield__input" type="text" id="precio_max" />
    <label class="mdl-textfield__label" for="precio_max" id="precio_max_default">Precio Max y eliminar filtros</label>
  </div>
</div>

   <!-- submit form buttos using javascript -->
          <a href="javascript: submitform()" class="mdl-button mdl-js-button mdl-js-ripple-effect">Buscar</a>
<form id="search_form" action="http://localhost:8080/cliente/productos/" method="post">
   <!-- csrf--> 
    {% csrf_token %}
   <!-- Keep in mind do a dirty flag for search changes --> 
  <!-- data to collect, categoria, sub_categoria, search field, and page (if the search was updated -->
</form>


{% endblock  %}



{% block content %}

  <div class="demo-cards mdl-card mdl-shadow--2dp mdl-cell mdl-cell--3-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
  <div class="mdl-grid demo-content">

<!-- TODO: counld be nice replace all this for an endpoint that provides the HTML-->
{% for producto in product_list %}
    <div class="mdl-cell mdl-cell--5-col">
      <div class="demo-card-promo mdl-card mdl-shadow--2dp">
        <div class="mdl-card__title">

          <h2 class="mdl-card__title-text">
{{ producto.nombre }}
          </h2>
        </div>
        <div class="mdl-card__supporting-text">
{{ producto.descripcion }}
        </div>
        <div class="mdl-card__actions mdl-card--border">
          <a href="/add_order/{{ producto.id  }}" class="mdl-button mdl-js-button mdl-js-ripple-effect">AÃ±adir al Pedido</a>
          <a href="/add_to_my_list/{{ producto.id }}" class="mdl-button mdl-js-button mdl-js-ripple-effect">lista</a>
        </div>
        <!-- IF IMAGE -->
          <div class="mdl-card__menu">
              <i class="material-icons">local_offer</i>
          </div>
        <!-- ENDIF IMAGE -->
      </div>
    </div>
  <!-- END Element-->
{% endfor %}
<!-- end of content block -->
<br>
<!-- not in nice place :( -->
<div class="pagination">
    <span class="step-links">
        {% if product_list.has_previous %}
            <a href="?page={{ product_list.previous_page_number }}">Ant < </a>
        {% endif %}

        <span class="current">
            Pag. {{ product_list.number }} de {{ product_list.paginator.num_pages }}
        </span>

        {% if product_list.has_next %}
            <a href="?page={{ product_list.next_page_number }}" onclick="alert('will not till you add the search params in the form the current page to it ')">Sig ></a>
        {% endif %}
    </span>
</div>

  </div>
  </div>

<br>
<!-- <img src="{% static "gip/images/dog.png" %}" alt="MyImage1">  -->

{% endblock %}

